<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garden Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            text-align: center;
        }
        .message {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }
        .green-text {
            color: green;
        }
        .ready-to-harvest {
            color: green;
            font-weight: bold;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
    </style>
</head>
<body>
    <div id="app">
        <h1>Garden Maturity Tracker</h1>
        <div style="display:grid;justify-content:center;align-items:center;text-align:left;">
            <label for="plantDate" style="color:green;font-size: large;">Plant Date</label>
            <input type="date" id="plantDate"><br>
            <label for="category" style="color:green;font-size: large;">Category</label>
            <select id="category">
                <option value="Plants for Chefs">Plants for Chefs</option>
                <option value="Sad Salad Girlies">Sad Salad Girlies</option>
                <option value="Flower Lovers">Flower Lovers</option>
            </select><br><br>
            <button id="showMaturityBtn" style="background-color: green; color:white; padding: 8px; border:none; border-radius:10px">Show Maturity</button>
        </div>
            <div id="results"></div>

    </div>

    <script type="module">
        import { plants } from './plants.js';

        // Calculate Garden Age Function
        function calculateGardenAge() {
            const plantDateInput = document.getElementById("plantDate").value;
            if (!plantDateInput) return;

            const plantDate = new Date(plantDateInput);
            const today = new Date();
            const diffTime = Math.abs(today - plantDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const results = document.getElementById("results");

            document.getElementById("garden-age").textContent = diffDays;
        }

        // Calculate Maturity Function
        function calculateMaturity() {
            console.log("calculateMaturity called");

            const plantDateInput = document.getElementById("plantDate").value;
            const category = document.getElementById("category").value;
            const results = document.getElementById("results");
            results.innerHTML = '<br><div class="message">Congrats! Your garden is <span class="green-text" id="garden-age">0</span> days old.</div>';
            calculateGardenAge(); // Update garden age at the top

            if (!plantDateInput || !category) {
                results.innerHTML += "<p>Please select a plant start date and a category.</p>";
                return;
            }

            const plantDate = new Date(plantDateInput);
            const today = new Date();
            const filteredPlants = plants.filter(plant => plant.category === category);

            console.log("Filtered Plants:", filteredPlants);

            const sortedPlants = filteredPlants
                .map(plant => {
                    const daysToMaturity = plant.daysToMaturity;
                    const maturityDate = new Date(plantDate);
                    maturityDate.setDate(maturityDate.getDate() + daysToMaturity);

                    const daysUntilMature = Math.ceil((maturityDate - today) / (1000 * 60 * 60 * 24));
                    return { ...plant, daysUntilMature, maturityDate };
                })
                .sort((a, b) => a.daysUntilMature - b.daysUntilMature);

            console.log("Sorted Plants:", sortedPlants);

            const table = document.createElement("table");
            const thead = document.createElement("thead");
            thead.innerHTML = "<tr><th>Plant</th><th>Maturity Status</th></tr>";
            table.appendChild(thead);

            const tbody = document.createElement("tbody");
            sortedPlants.forEach(plant => {
                const row = document.createElement("tr");
                const plantCell = document.createElement("td");
                const statusCell = document.createElement("td");

                plantCell.textContent = plant.name;

                if (plant.daysUntilMature <= 0) {
                    statusCell.innerHTML = `<span class="ready-to-harvest">Plant is ready to harvest! Maturity expected ${Math.abs(plant.daysUntilMature)} days ago.</span>`;
                } else {
                    statusCell.textContent = `${plant.daysUntilMature} days until maturity`;
                }

                row.appendChild(plantCell);
                row.appendChild(statusCell);
                tbody.appendChild(row);
            });

            table.appendChild(tbody);
            results.appendChild(table);
        }

        // Add event listener to the button after DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('showMaturityBtn').addEventListener('click', calculateMaturity);
        });
    </script>
    <p style="text-align: center;"> Made by <a href="https://www.linkedin.com/in/millerbrooke">Brooke Miller</a>.  Enjoyed? <a href="https://venmo.com/u/Brooke-Miller-5">Buy me a coffee</a>!</p>
</body>
</html>
